{% extends "layout.html" %}

{% block title %}
    Watchlist
{% endblock %}

{% block main %}
    <h2 class="mb-4">ðŸ“ˆ Stock Watchlist</h2>

    <!-- Add new stock form -->
    <form action="/watchlist" method="post" class="mb-4">
        <div class="form-row d-flex flex-wrap gap-2 align-items-center">
            <input autocomplete="off" autofocus class="form-control w-auto" name="symbol" placeholder="Symbol (e.g., AAPL)" required type="text">
            <input class="form-control w-auto" name="target_price" placeholder="Target Price (e.g., 150.00)" required step="0.01" type="number">
            <select name="direction" class="form-control w-auto" required>
                <option value="above">Above</option>
                <option value="below">Below</option>
            </select>
            <button class="btn btn-primary" type="submit">Add to Watchlist</button>
        </div>
    </form>

    <!-- Watchlist Table -->
    {% if watchlist %}
        <table class="table table-striped table-bordered text-center">
            <thead class="thead-dark">
                <tr>
                    <th>Symbol</th>
                    <th>Current Price</th>
                    <th>Target Price</th>
                    <th>Direction</th>
                    <th>Status</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for stock in watchlist %}
                <tr>
                    {% if edit_id == stock.id %}
                        <!-- Editable row -->
                        <form action="/watchlist/edit/{{ stock.id }}" method="post">
                            <td>{{ stock.symbol }}</td>
                            <td>${{ "%.2f"|format(stock.current_price) }}</td>
                            <td>
                                <input type="number" name="target_price" value="{{ stock.target_price }}" class="form-control" step="0.01" required>
                            </td>
                            <td>
                                <select name="direction" class="form-control">
                                    <option value="above" {% if stock.direction == 'above' %}selected{% endif %}>Above</option>
                                    <option value="below" {% if stock.direction == 'below' %}selected{% endif %}>Below</option>
                                </select>
                            </td>
                            <td>{{ stock.status }}</td>
                            <td>
                                <button type="submit" class="btn btn-sm btn-success">Save</button>
                                <a href="/watchlist" class="btn btn-sm btn-secondary">Cancel</a>
                            </td>
                        </form>
                    {% else %}
                        <!-- Read-only row -->
                        <td>{{ stock.symbol }}</td>
                        <td>${{ "%.2f"|format(stock.current_price) }}</td>
                        <td>${{ "%.2f"|format(stock.target_price) }}</td>
                        <td>{{ stock.direction }}</td>
                        <td>{{ stock.status }}</td>
                        <td>
                            <a href="/watchlist/edit/{{ stock.id }}" class="btn btn-sm btn-warning">Edit</a>
                            <form action="/watchlist/delete/{{ stock.id }}" method="post" style="display:inline;">
                                <button class="btn btn-sm btn-danger" type="submit">Delete</button>
                            </form>
                        </td>
                    {% endif %}
                </tr>
                {% endfor %}

            </tbody>
        </table>
    {% else %}
        <p class="text-muted">No stocks in your watchlist yet. Add one above!</p>
    {% endif %}
{% endblock %}
